//// ----------------------------------------------------
////      DBML Schema for ParacambiAlerta Project
////      Last Updated: 2025-09-01
//// ----------------------------------------------------

Table users as "users.BasicUser" {
  id integer [pk, increment]
  username varchar [unique, not null]
  email varchar [unique, not null]
  password varchar [not null]
  first_name varchar
  last_name varchar
  type varchar [note: "Enum: Cidadao, AutoridadeMunicipal, LiderComunitario"]
  created_at timestamp [default: `now()`]

  Note: "Represents all users of the platform."
}

Table categories {
  id integer [pk, increment]
  name varchar(100) [unique, not null]
  description text
}

Table geolocations {
  id integer [pk, increment]
  latitude decimal(10, 8) [not null]
  longitude decimal(11, 8) [not null]
  address varchar
}

Table reports {
  id integer [pk, increment]
  title varchar(255) [not null]
  description text [not null]
  status varchar(20) [not null, default: "'PENDING'"]
  votes_count integer [default: 0]
  created_at timestamp [default: `now()`]
  updated_at timestamp

  reporter_id integer [ref: > users.id, not null]
  category_id integer [ref: > categories.id]
  geolocation_id integer [ref: > geolocations.id, not null]
}

Table report_images {
  id integer [pk, increment]
  report_id integer [ref: > reports.id, not null]
  image_url varchar [not null]
  uploaded_at timestamp [default: `now()`]
}

Table comments {
  id integer [pk, increment]
  content text [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp

  user_id integer [ref: > users.id, not null]
  report_id integer [ref: > reports.id, not null]
}

Table votes {
  user_id integer [ref: > users.id, not null]
  report_id integer [ref: > reports.id, not null]
  created_at timestamp [default: `now()`]

  Indexes {
    (user_id, report_id) [pk]
  }
}

Table report_status_history {
  id integer [pk, increment]
  status_from varchar(20)
  status_to varchar(20) [not null]
  changed_at timestamp [default: `now()`]
  notes text

  report_id integer [ref: > reports.id, not null]
  user_id integer [ref: > users.id, not null, note: "The user (authority) who changed the status"]
}